<div class="card shadow-sm">
  <div class="container-fluid p-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h4>
        <i class="fa-solid fa-user-check me-2 text-danger"></i>
        Attendance Status
      </h4>

      <div class="d-flex gap-2">
        <div class="dropdown">
          <button class="btn btn-outline-dark dropdown-toggle" data-bs-toggle="dropdown">
            Export
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" (click)="exportAs('pdf')">PDF</a></li>
            <li><a class="dropdown-item" (click)="exportAs('excel')">Excel</a></li>
          </ul>
        </div>

        <button class="btn btn-danger" (click)="openUploadPopup()">Bulk Upload</button>
      </div>
    </div>

    <!-- FORM -->
    <div class="card mb-4">
      <div class="card-body">
        <form #f="ngForm" (ngSubmit)="onSubmit()">

          <div class="row g-3">

            <div class="col-md-4">
              <label>Attendance Status *</label>
              <input class="form-control"
                     name="AttendanceStatusName"
                     [(ngModel)]="attendance.AttendanceStatusName"
                     required>
            </div>

            <div class="col-md-4">
              <label>Company *</label>
              <select class="form-select"
                      [(ngModel)]="companyId"
                      name="CompanyId"
                      (change)="onCompanyChange()"
                      required>
                <option value="">Select</option>
                <option *ngFor="let c of companies" [value]="c.companyId">
                  {{ c.companyName }}
                </option>
              </select>
            </div>

            <div class="col-md-4">
              <label>Region *</label>
              <select class="form-select"
                      [(ngModel)]="regionId"
                      name="RegionId"
                      (change)="onRegionChange()"
                      required>
                <option value="">Select</option>
                <option *ngFor="let r of regions" [value]="r.regionID">
                  {{ r.regionName }}
                </option>
              </select>
            </div>

            <div class="col-md-2 mt-4">
              <div class="form-check form-switch">
                <input class="form-check-input"
                       type="checkbox"
                       [(ngModel)]="attendance.IsActive"
                       name="IsActive">
                <label class="form-check-label">Active</label>
              </div>
            </div>

            <div class="col-md-10 text-end mt-4">
              <button class="btn btn-success me-2" [disabled]="!f.valid">
                {{ isEditMode ? 'Update' : 'Save' }}
              </button>
              <button type="button" class="btn btn-secondary" (click)="resetForm()">Reset</button>
            </div>

          </div>
        </form>
      </div>
    </div>

    <!-- TABLE -->
    <div class="card">
      <div class="card-body">

        <input class="form-control w-25 mb-3"
               placeholder="Search"
               [(ngModel)]="searchText">

        <table class="table table-bordered">
          <thead>
            <tr>
              <th>#</th>
              <th (click)="sortTable('AttendanceStatusName')">
                Status <i class="fa" [ngClass]="getSortIcon('AttendanceStatusName')"></i>
              </th>
              <th>Company</th>
              <th>Region</th>
              <th>Active</th>
              <th>Actions</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let a of pagedAttendance; let i = index">
              <td>{{ (currentPage - 1) * pageSize + i + 1 }}</td>
              <td>{{ a.AttendanceStatusName }}</td>
              <td>{{ a.companyName }}</td>
              <td>{{ a.regionName }}</td>
              <td>
                <span class="badge" [ngClass]="a.IsActive ? 'bg-success' : 'bg-secondary'">
                  {{ a.IsActive ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td>
                <button class="btn btn-sm btn-outline-primary me-2"
                        (click)="editAttendance(a)">
                  <i class="fa fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger"
                        (click)="deleteAttendance(a)">
                  <i class="fa fa-trash"></i>
                </button>
              </td>
            </tr>

            <tr *ngIf="pagedAttendance.length === 0">
              <td colspan="6" class="text-center">No records found</td>
            </tr>
          </tbody>
        </table>

        <!-- PAGINATION -->
        <nav *ngIf="totalPages > 1" class="d-flex justify-content-end">
          <ul class="pagination pagination-sm">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <a class="page-link" (click)="changePage(currentPage - 1)">Prev</a>
            </li>
            <li class="page-item"
                *ngFor="let p of [].constructor(totalPages); let i = index"
                [class.active]="currentPage === i + 1">
              <a class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</a>
            </li>
            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <a class="page-link" (click)="changePage(currentPage + 1)">Next</a>
            </li>
          </ul>
        </nav>

      </div>
    </div>

  </div>
</div>

<app-common-upload
  [visible]="showUploadPopup"
  [screenName]="'Attendance Status'"
  (close)="closeUploadPopup()"
  (uploadComplete)="onBulkUploadComplete($event)">
</app-common-upload>
