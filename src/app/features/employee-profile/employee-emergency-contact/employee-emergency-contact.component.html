<div class="card shadow-sm p-4">

  <!-- FORM -->
  <form class="row g-3 align-items-end mb-4" [formGroup]="contactForm" (ngSubmit)="onSubmit()">
    <div class="col-md-4">
      <label class="form-label">Contact Name *</label>
      <input class="form-control" type="text" placeholder="Enter full name" formControlName="contactName" />
      <div *ngIf="f['contactName'].touched && f['contactName'].invalid" class="text-danger small mt-1">
        Contact name is required and must be valid.
      </div>
    </div>

    <div class="col-md-4">
      <label class="form-label">Relationship *</label>
      <select class="form-select" formControlName="relationshipId">
        <option value="">Select relationship</option>
        <option *ngFor="let r of relationships" [value]="r.relationshipID">{{ r.relationshipName }}</option>
      </select>
      <div *ngIf="f['relationshipId'].touched && f['relationshipId'].invalid" class="text-danger small mt-1">
        Relationship is required.
      </div>
    </div>

    <div class="col-md-4">
      <label class="form-label">Phone Number *</label>
      <input class="form-control" type="tel" placeholder="Enter phone number" formControlName="phoneNumber" />
      <div *ngIf="f['phoneNumber'].touched && f['phoneNumber'].invalid" class="text-danger small mt-1">
        Phone number is required and must be valid.
      </div>
    </div>

    <div class="col-md-4">
      <label class="form-label">Alternate Phone</label>
      <input class="form-control" type="tel" placeholder="Enter alternate phone" formControlName="alternatePhone" />
    </div>

    <div class="col-md-4">
      <label class="form-label">Email</label>
      <input class="form-control" type="email" placeholder="Enter email" formControlName="email" />
      <div *ngIf="f['email'].touched && f['email'].invalid" class="text-danger small mt-1">
        Enter a valid email.
      </div>
    </div>

    <div class="col-12">
      <label class="form-label">Address</label>
      <textarea class="form-control" rows="2" placeholder="Enter address" formControlName="address"></textarea>
    </div>

    <div class="col-12 d-flex align-items-center">
      <div class="ms-auto">
        <button type="submit" class="btn btn-dark me-2">{{ editMode ? 'Update Contact' : 'Add Contact' }}</button>
        <button type="button" class="btn btn-outline-secondary" (click)="resetForm()">Reset</button>
      </div>
    </div>
  </form>

  <!-- Search -->
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
    <div style="max-width: 350px; width: 100%;">
      <input class="form-control" type="text"
             placeholder="Search name / relationship / phone / email / address"
             [(ngModel)]="searchText" name="contactSearch"
             (ngModelChange)="currentPage = 1" />
    </div>
  </div>

  <!-- TABLE -->
  <div class="table-responsive">
    <table class="table table-bordered table-hover align-middle mb-0">
      <thead class="table-dark">
        <tr>
          <th style="width:60px; text-align:center">S.No</th>
          <th (click)="sortBy('contactName')" style="cursor:pointer">
            Contact Name <small *ngIf="sortColumn === 'contactName'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</small>
          </th>
          <th (click)="sortBy('relationship')" style="cursor:pointer">
            Relationship <small *ngIf="sortColumn === 'relationship'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</small>
          </th>
          <th (click)="sortBy('phoneNumber')" style="cursor:pointer">
            Phone <small *ngIf="sortColumn === 'phoneNumber'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</small>
          </th>
          <th>Alt. Phone</th>
          <th>Email</th>
          <th>Address</th>
          <th style="width:120px; text-align:center">Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let item of filteredContacts(); let i = index">
          <td style="text-align:center">{{ (currentPage - 1) * pageSize + i + 1 }}</td>
          <td>{{ item.contactName }}</td>
          <td>{{ item.relationship }}</td>
          <td>{{ item.phoneNumber || '--' }}</td>
          <td>{{ item.alternatePhone || '--' }}</td>
          <td>{{ item.email || '--' }}</td>
          <td>{{ item.address || '--' }}</td>
          <td class="text-center">
            <button class="btn btn-sm btn-light me-1" title="Edit" (click)="edit(item)"><i class="fa-solid fa-pen"></i></button>
            <button class="btn btn-sm btn-outline-danger" title="Delete" (click)="delete(item.emergencyContactId)"><i class="fa-solid fa-trash"></i></button>
          </td>
        </tr>

        <tr *ngIf="filteredContacts().length === 0">
          <td colspan="8" class="text-center py-3">No emergency contacts found.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination footer -->
  <div class="d-flex justify-content-between align-items-center mt-3">
    <div class="d-flex align-items-center gap-2">
      <label class="mb-0 small">Show:</label>
      <select class="form-select form-select-sm" style="width:90px;"
              [(ngModel)]="pageSize" name="contactPageSize"
              (change)="changePageSize(pageSize)">
        <option *ngFor="let s of pageSizeOptions" [ngValue]="s">{{ s }}</option>
      </select>
    
    </div>

    <div class="btn-group" role="group" aria-label="pagination">
      <button class="btn btn-sm btn-outline-secondary" (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1">Previous</button>
      <button class="btn btn-sm btn-outline-secondary" (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages">Next</button>
    </div>
  </div>

</div>
